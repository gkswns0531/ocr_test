# MinerU 2.7.6+ official setup with vLLM backend
# GPU: Ampere, Ada Lovelace, Hopper (8.0 <= Compute Capability <= 9.0)
# Based on: https://github.com/opendatalab/MinerU/blob/master/docker/global/Dockerfile
FROM vllm/vllm-openai:v0.10.1.1

# Install libgl for opencv support & Noto fonts for CJK characters
RUN apt-get update && \
    apt-get install -y \
        fonts-noto-core \
        fonts-noto-cjk \
        fontconfig \
        libgl1 && \
    fc-cache -fv && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Install mineru latest (2.7.6+)
RUN python3 -m pip install -U 'mineru[core]>=2.7.0' --break-system-packages && \
    python3 -m pip cache purge

# Download models (MinerU2.5-2509-1.2B VLM + pipeline models)
RUN /bin/bash -c "mineru-models-download -s huggingface -m all"

# Set the entry point
ENTRYPOINT ["/bin/bash", "-c", "export MINERU_MODEL_SOURCE=local && exec \"$@\"", "--"]
